nohup: 忽略输入
Training llama model 7b using 2 GPUs, 2 batch size per GPU, 32 gradient accumulation steps
Output dir: models/llama2-gsm123-7b
The following values were not passed to `accelerate launch` and had defaults used instead:
		More than one GPU was found, enabling multi-GPU training.
		If this was unintended please pass in `--num_processes=1`.
	`--dynamo_backend` was set to a value of `'no'`
To avoid this warning pass in values for each of the problematic parameters or run `accelerate config`.
[2025-02-27 23:07:54,180] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to cuda (auto detect)
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/transformers/utils/generic.py:311: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
W0227 23:07:55.895000 541631 site-packages/torch/distributed/run.py:793] 
W0227 23:07:55.895000 541631 site-packages/torch/distributed/run.py:793] *****************************************
W0227 23:07:55.895000 541631 site-packages/torch/distributed/run.py:793] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0227 23:07:55.895000 541631 site-packages/torch/distributed/run.py:793] *****************************************
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/transformers/utils/generic.py:311: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/transformers/utils/generic.py:311: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/transformers/deepspeed.py:23: FutureWarning: transformers.deepspeed module is deprecated and will be removed in a future version. Please import deepspeed modules directly from transformers.integrations
  warnings.warn(
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/transformers/deepspeed.py:23: FutureWarning: transformers.deepspeed module is deprecated and will be removed in a future version. Please import deepspeed modules directly from transformers.integrations
  warnings.warn(
[2025-02-27 23:07:59,117] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2025-02-27 23:07:59,119] [INFO] [real_accelerator.py:222:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2025-02-27 23:08:00,253] [INFO] [comm.py:652:init_distributed] cdb=None
[2025-02-27 23:08:00,266] [INFO] [comm.py:652:init_distributed] cdb=None
[2025-02-27 23:08:00,266] [INFO] [comm.py:683:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
02/27/2025 23:08:00 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 2
Process index: 0
Local process index: 0
Device: cuda:0

Mixed precision type: bf16
ds_config: {'bf16': {'enabled': True}, 'zero_optimization': {'stage': 3, 'overlap_comm': True, 'contiguous_gradients': True, 'sub_group_size': 1000000000.0, 'reduce_bucket_size': 'auto', 'stage3_prefetch_bucket_size': 'auto', 'stage3_param_persistence_threshold': 'auto', 'stage3_max_live_parameters': 1000000000.0, 'stage3_max_reuse_distance': 1000000000.0, 'stage3_gather_16bit_weights_on_model_save': True, 'offload_param': {'device': 'cpu'}, 'offload_optimizer': {'device': 'cpu'}}, 'gradient_accumulation_steps': 'auto', 'gradient_clipping': 'auto', 'steps_per_print': inf, 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'wall_clock_breakdown': False, 'fp16': {'enabled': False}}

[rank0]:[W227 23:08:00.105159798 ProcessGroupNCCL.cpp:4115] [PG ID 0 PG GUID 0 Rank 0]  using GPU 0 to perform barrier as devices used by this process are currently unknown. This can potentially cause a hang if this rank to GPU mapping is incorrect.Specify device_ids in barrier() to force use of a particular device,or call init_process_group() with a device_id.
02/27/2025 23:08:00 - INFO - __main__ - Distributed environment: DEEPSPEED  Backend: nccl
Num processes: 2
Process index: 1
Local process index: 1
Device: cuda:1

Mixed precision type: bf16
ds_config: {'bf16': {'enabled': True}, 'zero_optimization': {'stage': 3, 'overlap_comm': True, 'contiguous_gradients': True, 'sub_group_size': 1000000000.0, 'reduce_bucket_size': 'auto', 'stage3_prefetch_bucket_size': 'auto', 'stage3_param_persistence_threshold': 'auto', 'stage3_max_live_parameters': 1000000000.0, 'stage3_max_reuse_distance': 1000000000.0, 'stage3_gather_16bit_weights_on_model_save': True, 'offload_param': {'device': 'cpu'}, 'offload_optimizer': {'device': 'cpu'}}, 'gradient_accumulation_steps': 'auto', 'gradient_clipping': 'auto', 'steps_per_print': inf, 'train_batch_size': 'auto', 'train_micro_batch_size_per_gpu': 'auto', 'wall_clock_breakdown': False, 'fp16': {'enabled': False}}

[rank1]:[W227 23:08:00.153653138 ProcessGroupNCCL.cpp:4115] [PG ID 0 PG GUID 0 Rank 1]  using GPU 1 to perform barrier as devices used by this process are currently unknown. This can potentially cause a hang if this rank to GPU mapping is incorrect.Specify device_ids in barrier() to force use of a particular device,or call init_process_group() with a device_id.
loading configuration file /mnt/data1/wangyatong/proxy-tuning/scripts/models/llama2-gsm12-merged/config.json
Model config LlamaConfig {
  "_name_or_path": "/mnt/data1/wangyatong/proxy-tuning/scripts/models/llama2-gsm12-merged",
  "architectures": [
    "LlamaForCausalLM"
  ],
  "attention_bias": false,
  "bos_token_id": 1,
  "eos_token_id": 2,
  "hidden_act": "silu",
  "hidden_size": 4096,
  "initializer_range": 0.02,
  "intermediate_size": 11008,
  "max_position_embeddings": 4096,
  "model_type": "llama",
  "num_attention_heads": 32,
  "num_hidden_layers": 32,
  "num_key_value_heads": 32,
  "pretraining_tp": 1,
  "rms_norm_eps": 1e-05,
  "rope_scaling": null,
  "rope_theta": 10000.0,
  "tie_word_embeddings": false,
  "torch_dtype": "float32",
  "transformers_version": "4.35.0.dev0",
  "use_cache": true,
  "vocab_size": 32000
}

loading file tokenizer.model
loading file added_tokens.json
loading file special_tokens_map.json
loading file tokenizer_config.json
loading file tokenizer.json
Adding <s> to the vocabulary
Adding </s> to the vocabulary
Adding <unk> to the vocabulary
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
loading weights file /mnt/data1/wangyatong/proxy-tuning/scripts/models/llama2-gsm12-merged/pytorch_model.bin.index.json
Detected DeepSpeed ZeRO-3: activating zero.init() for this model
[2025-02-27 23:08:02,251] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 2
[2025-02-27 23:08:02,252] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 2
Generate config GenerationConfig {
  "bos_token_id": 1,
  "eos_token_id": 2
}

[2025-02-27 23:08:07,710] [INFO] [partition_parameters.py:348:__exit__] finished initializing model - num_params = 291, num_elems = 6.74B
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/transformers/modeling_utils.py:484: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  return torch.load(checkpoint_file, map_location=map_location)
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/transformers/modeling_utils.py:484: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  return torch.load(checkpoint_file, map_location=map_location)
Loading checkpoint shards:  33%|███▎      | 1/3 [00:12<00:24, 12.14s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:12<00:25, 12.64s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:24<00:12, 12.22s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:24<00:12, 12.41s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 10.74s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 11.13s/it]
Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 10.77s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 11.24s/it]
All model checkpoint weights were used when initializing LlamaForCausalLM.

All the weights of LlamaForCausalLM were initialized from the model checkpoint at /mnt/data1/wangyatong/proxy-tuning/scripts/models/llama2-gsm12-merged.
If your task is similar to the task the model of the checkpoint was trained on, you can already use LlamaForCausalLM for predictions without further training.
loading configuration file /mnt/data1/wangyatong/proxy-tuning/scripts/models/llama2-gsm12-merged/generation_config.json
Generate config GenerationConfig {
  "bos_token_id": 1,
  "do_sample": true,
  "eos_token_id": 2,
  "max_length": 4096,
  "pad_token_id": 0,
  "temperature": 0.6,
  "top_p": 0.9
}

Assigning <s> to the bos_token key of the tokenizer
Assigning </s> to the eos_token key of the tokenizer
Assigning <unk> to the unk_token key of the tokenizer
Assigning </s> to the pad_token key of the tokenizer
Adding <s> to the vocabulary
Adding </s> to the vocabulary
Adding <unk> to the vocabulary
You are resizing the embedding layer without providing a `pad_to_multiple_of` parameter. This means that the new embedding dimension will be 32000. This might induce some performance reduction as *Tensor Cores* will not be available. For more details about this, or help on choosing the correct value for resizing, refer to this guide: https://docs.nvidia.com/deeplearning/performance/dl-performance-matrix-multiplication/index.html#requirements-tc
02/27/2025 23:08:41 - INFO - __main__ - Initializing LORA model...
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/auto_gptq/nn_modules/triton_utils/kernels.py:360: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
  def forward(ctx, input, qweight, scales, qzeros, g_idx, bits, maxq):
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/auto_gptq/nn_modules/triton_utils/kernels.py:368: FutureWarning: `torch.cuda.amp.custom_bwd(args...)` is deprecated. Please use `torch.amp.custom_bwd(args..., device_type='cuda')` instead.
  def backward(ctx, grad_output):
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/auto_gptq/nn_modules/triton_utils/kernels.py:399: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
  @custom_fwd(cast_inputs=torch.float16)
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/auto_gptq/nn_modules/triton_utils/kernels.py:360: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
  def forward(ctx, input, qweight, scales, qzeros, g_idx, bits, maxq):
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/auto_gptq/nn_modules/triton_utils/kernels.py:368: FutureWarning: `torch.cuda.amp.custom_bwd(args...)` is deprecated. Please use `torch.amp.custom_bwd(args..., device_type='cuda')` instead.
  def backward(ctx, grad_output):
/mnt/data1/wangyatong/anaconda3/envs/proxy/lib/python3.10/site-packages/auto_gptq/nn_modules/triton_utils/kernels.py:399: FutureWarning: `torch.cuda.amp.custom_fwd(args...)` is deprecated. Please use `torch.amp.custom_fwd(args..., device_type='cuda')` instead.
  @custom_fwd(cast_inputs=torch.float16)
02/27/2025 23:08:41 - WARNING - auto_gptq.nn_modules.qlinear.qlinear_cuda - CUDA extension not installed.
02/27/2025 23:08:41 - WARNING - auto_gptq.nn_modules.qlinear.qlinear_cuda_old - CUDA extension not installed.
02/27/2025 23:08:41 - WARNING - auto_gptq.nn_modules.qlinear.qlinear_cuda - CUDA extension not installed.
02/27/2025 23:08:41 - WARNING - auto_gptq.nn_modules.qlinear.qlinear_cuda_old - CUDA extension not installed.
trainable params: 159,907,840 || all params: 6,898,323,456 || trainable%: 2.3180681656919973
Using sep_token, but it is not set yet.
Using cls_token, but it is not set yet.
Using mask_token, but it is not set yet.
trainable params: 159,907,840 || all params: 6,898,323,456 || trainable%: 2.3180681656919973
Using sep_token, but it is not set yet.
Using cls_token, but it is not set yet.
Using mask_token, but it is not set yet.
02/27/2025 23:09:56 - INFO - __main__ - Sample 144 of the training set: {'input_ids': tensor([    1,   894, 29901,  6015,   533,  2113,   263,   395, 29896, 29900,
        29900, 19797,  5881,   304,   902, 25448, 26935, 18296, 29889,  2296,
        10753,   304,  7539,  8735,   304,   263,  3405,   371,   393,  3438,
          395, 29941, 29889, 29955, 29945,   322,   263,  8182, 19505,   363,
          395, 29941, 29889, 29945, 29900,  1432,  7250,   363,   263,  4723,
        29889, 29871,  2296,   884, 13900,   304, 15649, 29871, 29945, 21046,
          393,  3438,   395, 29896, 29889, 29906, 29945,  1269, 29889,  1128,
         1568,  6909,   674,   367,  2175,   373,   902,  5881,  1156,   263,
         4723,   310, 26935,   322,  2331,  2202, 29973,    13, 22550, 29901,
         7569,  2462,  1183,  1321,   952,   395, 29941, 29889, 29955, 29945,
         3405,   371,   322,   395, 29941, 29889, 29945, 29900,  8182, 19505,
          363,   263,  3001,   310, 29871, 29941, 29889, 29955, 29945, 29974,
        29941, 29889, 29945, 29900,   353,   395,  9314, 29941, 29889, 29955,
        29945, 29974, 29941, 29889, 29945, 29900, 29922, 29955, 29889, 29906,
        29945,  6778, 29955, 29889, 29906, 29945,   639,  2462,    13,  3644,
         1183,   805,  1975,   395, 29955, 29889, 29906, 29945,   263,  2462,
          363, 29871, 29955,  3841,  1183,   674, 18864, 29871, 29955, 29889,
        29906, 29945, 29930, 29955,   353,   395,  9314, 29955, 29889, 29906,
        29945, 29930, 29955, 29922, 29945, 29900, 29889, 29955, 29945,  6778,
        29945, 29900, 29889, 29955, 29945,   297,   697,  4723,    13,  3644,
         1183,  1321,   952, 29871, 29945, 21046,   472,   395, 29896, 29889,
        29906, 29945,  1269,  1183,   674, 18864, 29871, 29945, 29930, 29896,
        29889, 29906, 29945,   353,   395,  9314, 29945, 29930, 29896, 29889,
        29906, 29945, 29922, 29953, 29889, 29906, 29945,  6778, 29953, 29889,
        29906, 29945,    13, 18650, 19797,  5881,   338,   363,   395, 29896,
        29900, 29900,   322,  1183,   805,  1975,   395, 29945, 29900, 29889,
        29955, 29945,   322,   385,  5684,   395, 29953, 29889, 29906, 29945,
          393,   674,  5967,   902,   411, 29871, 29896, 29900, 29900, 29899,
        29945, 29900, 29889, 29955, 29945, 29899, 29953, 29889, 29906, 29945,
          353,   395,  9314, 29896, 29900, 29900, 29899, 29945, 29900, 29889,
        29955, 29945, 29899, 29953, 29889, 29906, 29945, 29922, 29946, 29941,
        29889, 29900, 29900,  6778, 29946, 29941, 29889, 29900, 29900,   373,
          902, 19797,  5881,    13,  4136, 29871, 29946, 29941,     2]), 'labels': tensor([ -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         7569,  2462,  1183,  1321,   952,   395, 29941, 29889, 29955, 29945,
         3405,   371,   322,   395, 29941, 29889, 29945, 29900,  8182, 19505,
          363,   263,  3001,   310, 29871, 29941, 29889, 29955, 29945, 29974,
        29941, 29889, 29945, 29900,   353,   395,  9314, 29941, 29889, 29955,
        29945, 29974, 29941, 29889, 29945, 29900, 29922, 29955, 29889, 29906,
        29945,  6778, 29955, 29889, 29906, 29945,   639,  2462,    13,  3644,
         1183,   805,  1975,   395, 29955, 29889, 29906, 29945,   263,  2462,
          363, 29871, 29955,  3841,  1183,   674, 18864, 29871, 29955, 29889,
        29906, 29945, 29930, 29955,   353,   395,  9314, 29955, 29889, 29906,
        29945, 29930, 29955, 29922, 29945, 29900, 29889, 29955, 29945,  6778,
        29945, 29900, 29889, 29955, 29945,   297,   697,  4723,    13,  3644,
         1183,  1321,   952, 29871, 29945, 21046,   472,   395, 29896, 29889,
        29906, 29945,  1269,  1183,   674, 18864, 29871, 29945, 29930, 29896,
        29889, 29906, 29945,   353,   395,  9314, 29945, 29930, 29896, 29889,
        29906, 29945, 29922, 29953, 29889, 29906, 29945,  6778, 29953, 29889,
        29906, 29945,    13, 18650, 19797,  5881,   338,   363,   395, 29896,
        29900, 29900,   322,  1183,   805,  1975,   395, 29945, 29900, 29889,
        29955, 29945,   322,   385,  5684,   395, 29953, 29889, 29906, 29945,
          393,   674,  5967,   902,   411, 29871, 29896, 29900, 29900, 29899,
        29945, 29900, 29889, 29955, 29945, 29899, 29953, 29889, 29906, 29945,
          353,   395,  9314, 29896, 29900, 29900, 29899, 29945, 29900, 29889,
        29955, 29945, 29899, 29953, 29889, 29906, 29945, 29922, 29946, 29941,
        29889, 29900, 29900,  6778, 29946, 29941, 29889, 29900, 29900,   373,
          902, 19797,  5881,    13,  4136, 29871, 29946, 29941,     2]), 'attention_mask': tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1])}.
02/27/2025 23:09:56 - INFO - __main__ - Sample 152 of the training set: {'input_ids': tensor([    1,   894, 29901,  7991,   338,  3428,   292,   263,  6492,   310,
          670, 16423, 29889,   450,  6492,   338, 29871, 29896, 29896, 29900,
         6900,  9377,   491, 29871, 29896, 29906, 29900,  6900,  1472, 29889,
         3600,  3428,   261,  4697, 29879,   263,  2381,   493,  1023,  6900,
         9377, 29892,   322,   540,   508,  3428, 29871, 29896,  3661,   310,
         5962,   297,  1048, 29871, 29906,  6923, 29889,  1128,  1472,   674,
          372,  2125,  1075,   304,  3428,   445,  6492,   310,  2982, 29892,
          297,  6233, 29973,    13, 22550, 29901,   960,  7991,  5771,  3412,
          278,  2625,   393, 29915, 29879, 29871, 29896, 29906, 29900,  6900,
         1472, 29892,   540,   674,  3428, 29871, 29896, 29896, 29900,   847,
        29871, 29906,   353, 29871, 29945, 29945,  4206, 29889,    13,  9760,
          310,  1438,  4206,   526, 29871, 29896, 29906, 29900,  6900,  1472,
        29892,   577,   540,   674,  5503,   278,  3428,   261,   263,  3001,
          310, 29871, 29896, 29906, 29900,   334, 29871, 29945, 29945,   353,
         3532, 29896, 29906, 29900, 29930, 29945, 29945, 29922, 29953, 29953,
        29900, 29900,  6778, 29953, 29892, 29953, 29900, 29900,  6900, 29889,
           13,  3868,  3428, 29879, 29871, 29896,  5608,  3661,   310,  5962,
         1432, 29871, 29906,  6923, 29892,   577,   372,   674,  2125,  1075,
        29871, 29906,   334, 29871, 29953, 29892, 29953, 29900, 29900,   353,
        29871, 29896, 29941, 29892, 29906, 29900, 29900,  6923,   304,  3428,
          445,  6492,    13, 29896, 29941, 29892, 29906, 29900, 29900,  6923,
          338, 29871, 29896, 29941, 29892, 29906, 29900, 29900, 29900,   847,
        29871, 29953, 29900,   353,  3532, 29896, 29941, 29906, 29900, 29900,
        29914, 29953, 29900, 29922, 29906, 29906, 29900,  6778, 29906, 29906,
        29900,  6233,    13,  4136, 29871, 29906, 29906, 29900,     2]), 'labels': tensor([ -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,   960,  7991,  5771,  3412,
          278,  2625,   393, 29915, 29879, 29871, 29896, 29906, 29900,  6900,
         1472, 29892,   540,   674,  3428, 29871, 29896, 29896, 29900,   847,
        29871, 29906,   353, 29871, 29945, 29945,  4206, 29889,    13,  9760,
          310,  1438,  4206,   526, 29871, 29896, 29906, 29900,  6900,  1472,
        29892,   577,   540,   674,  5503,   278,  3428,   261,   263,  3001,
          310, 29871, 29896, 29906, 29900,   334, 29871, 29945, 29945,   353,
         3532, 29896, 29906, 29900, 29930, 29945, 29945, 29922, 29953, 29953,
        29900, 29900,  6778, 29953, 29892, 29953, 29900, 29900,  6900, 29889,
           13,  3868,  3428, 29879, 29871, 29896,  5608,  3661,   310,  5962,
         1432, 29871, 29906,  6923, 29892,   577,   372,   674,  2125,  1075,
        29871, 29906,   334, 29871, 29953, 29892, 29953, 29900, 29900,   353,
        29871, 29896, 29941, 29892, 29906, 29900, 29900,  6923,   304,  3428,
          445,  6492,    13, 29896, 29941, 29892, 29906, 29900, 29900,  6923,
          338, 29871, 29896, 29941, 29892, 29906, 29900, 29900, 29900,   847,
        29871, 29953, 29900,   353,  3532, 29896, 29941, 29906, 29900, 29900,
        29914, 29953, 29900, 29922, 29906, 29906, 29900,  6778, 29906, 29906,
        29900,  6233,    13,  4136, 29871, 29906, 29906, 29900,     2]), 'attention_mask': tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1])}.
02/27/2025 23:09:56 - INFO - __main__ - Sample 224 of the training set: {'input_ids': tensor([    1,   894, 29901,   530,  7664,  3913, 29871, 29941, 29871,  1309,
          778,   310, 10675,   363,  1432,  2919, 10508,   896,  4612, 29892,
          322, 29871, 29906, 29871,  1309,   778,   310, 10675,   363,  1432,
         2319, 10508,   896,  4612, 29889, 30081,  2688,   505,  8676, 29871,
        29941,  2919, 10675,   886,   322, 29871, 29946,  2319, 10675,   886,
        29889, 30081,  1128,  1784, 29871,  1309,   778,   310, 10675,   505,
          896,  1304, 29973,    13, 22550, 29901,   450,  2919, 10675,   886,
          505,  1304, 29871, 29941,   334, 29871, 29941,   353,  3532, 29941,
        29930, 29941, 29922, 29929,  6778, 29929, 29871,  1309,   778, 29889,
           13,  1576,  2319, 10675,   886,   505,  1304, 29871, 29906,   334,
        29871, 29946,   353,  3532, 29906, 29930, 29946, 29922, 29947,  6778,
        29947, 29871,  1309,   778, 29889,    13,   797,  3001, 29892,   599,
          278, 10675,   886,   505, 30081,  3880, 29871, 29929, 30081, 29974,
        29871, 29947,   353,  3532, 29929, 29974, 29947, 29922, 29896, 29955,
         6778, 29896, 29955, 29871,  1309,   778, 29889,    13,  4136, 29871,
        29896, 29955,     2]), 'labels': tensor([ -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,  -100,
         -100,  -100,  -100,  -100,  -100,  -100,   450,  2919, 10675,   886,
          505,  1304, 29871, 29941,   334, 29871, 29941,   353,  3532, 29941,
        29930, 29941, 29922, 29929,  6778, 29929, 29871,  1309,   778, 29889,
           13,  1576,  2319, 10675,   886,   505,  1304, 29871, 29906,   334,
        29871, 29946,   353,  3532, 29906, 29930, 29946, 29922, 29947,  6778,
        29947, 29871,  1309,   778, 29889,    13,   797,  3001, 29892,   599,
          278, 10675,   886,   505, 30081,  3880, 29871, 29929, 30081, 29974,
        29871, 29947,   353,  3532, 29929, 29974, 29947, 29922, 29896, 29955,
         6778, 29896, 29955, 29871,  1309,   778, 29889,    13,  4136, 29871,
        29896, 29955,     2]), 'attention_mask': tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1])}.
Using /home/wangyatong/.cache/torch_extensions/py310_cu124 as PyTorch extensions root...
Emitting ninja build file /home/wangyatong/.cache/torch_extensions/py310_cu124/cpu_adam/build.ninja...
Building extension module cpu_adam...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
Using /home/wangyatong/.cache/torch_extensions/py310_cu124 as PyTorch extensions root...
ninja: no work to do.
Loading extension module cpu_adam...
Time to load cpu_adam op: 2.4851560592651367 seconds
Adam Optimizer #0 is created with AVX512 arithmetic capability.
Config: alpha=0.000100, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
[2025-02-27 23:10:00,633] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed info: version=0.16.3, git-hash=unknown, git-branch=unknown
[2025-02-27 23:10:00,634] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 2
[2025-02-27 23:10:00,679] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2025-02-27 23:10:00,682] [INFO] [logging.py:128:log_dist] [Rank 0] Using client Optimizer as basic optimizer
[2025-02-27 23:10:00,682] [INFO] [logging.py:128:log_dist] [Rank 0] Removing param_group that has no 'params' in the basic Optimizer
Loading extension module cpu_adam...
Time to load cpu_adam op: 2.551527976989746 seconds
Adam Optimizer #0 is created with AVX512 arithmetic capability.
Config: alpha=0.000100, betas=(0.900000, 0.999000), weight_decay=0.010000, adam_w=1
[2025-02-27 23:10:00,736] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 2
[2025-02-27 23:10:00,754] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed Basic Optimizer = DeepSpeedCPUAdam
[2025-02-27 23:10:00,754] [INFO] [utils.py:59:is_zero_supported_optimizer] Checking ZeRO support for optimizer=DeepSpeedCPUAdam type=<class 'deepspeed.ops.adam.cpu_adam.DeepSpeedCPUAdam'>
[2025-02-27 23:10:00,754] [INFO] [logging.py:128:log_dist] [Rank 0] Creating fp16 ZeRO stage 3 optimizer, MiCS is enabled False, Hierarchical params gather False
[2025-02-27 23:10:00,755] [INFO] [logging.py:128:log_dist] [Rank 0] Creating torch.bfloat16 ZeRO stage 3 optimizer
[2025-02-27 23:10:00,944] [INFO] [utils.py:781:see_memory_usage] Stage 3 initialize beginning
[2025-02-27 23:10:00,945] [INFO] [utils.py:782:see_memory_usage] MA 0.85 GB         Max_MA 1.21 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:00,945] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 35.57 GB, percent = 14.1%
[2025-02-27 23:10:00,951] [INFO] [stage3.py:169:__init__] Reduce bucket size 16777216
[2025-02-27 23:10:00,952] [INFO] [stage3.py:170:__init__] Prefetch bucket size 15099494
[2025-02-27 23:10:01,087] [INFO] [utils.py:781:see_memory_usage] DeepSpeedZeRoOffload initialize [begin]
[2025-02-27 23:10:01,087] [INFO] [utils.py:782:see_memory_usage] MA 0.85 GB         Max_MA 0.85 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:01,087] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 35.57 GB, percent = 14.1%
Parameter Offload: Total persistent parameters: 266240 in 65 params
[2025-02-27 23:10:01,764] [INFO] [utils.py:781:see_memory_usage] DeepSpeedZeRoOffload initialize [end]
[2025-02-27 23:10:01,765] [INFO] [utils.py:782:see_memory_usage] MA 0.06 GB         Max_MA 0.85 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:01,765] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 36.07 GB, percent = 14.3%
[2025-02-27 23:10:01,923] [INFO] [utils.py:781:see_memory_usage] Before creating fp16 partitions
[2025-02-27 23:10:01,924] [INFO] [utils.py:782:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:01,924] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 35.83 GB, percent = 14.2%
[2025-02-27 23:10:02,298] [INFO] [utils.py:781:see_memory_usage] After creating fp16 partitions: 1
[2025-02-27 23:10:02,299] [INFO] [utils.py:782:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:02,299] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 36.69 GB, percent = 14.6%
[2025-02-27 23:10:02,461] [INFO] [utils.py:781:see_memory_usage] Before creating fp32 partitions
[2025-02-27 23:10:02,462] [INFO] [utils.py:782:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:02,462] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 36.65 GB, percent = 14.6%
[2025-02-27 23:10:02,840] [INFO] [utils.py:781:see_memory_usage] After creating fp32 partitions
[2025-02-27 23:10:02,841] [INFO] [utils.py:782:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:02,841] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 36.96 GB, percent = 14.7%
[2025-02-27 23:10:03,016] [INFO] [utils.py:781:see_memory_usage] Before initializing optimizer states
[2025-02-27 23:10:03,017] [INFO] [utils.py:782:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:03,017] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 37.36 GB, percent = 14.9%
[2025-02-27 23:10:03,444] [INFO] [utils.py:781:see_memory_usage] After initializing optimizer states
[2025-02-27 23:10:03,445] [INFO] [utils.py:782:see_memory_usage] MA 0.06 GB         Max_MA 0.06 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:03,445] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 37.54 GB, percent = 14.9%
[2025-02-27 23:10:03,445] [INFO] [stage3.py:529:_setup_for_real_optimizer] optimizer state initialized
[2025-02-27 23:10:03,874] [INFO] [utils.py:781:see_memory_usage] After initializing ZeRO optimizer
[2025-02-27 23:10:03,874] [INFO] [utils.py:782:see_memory_usage] MA 0.09 GB         Max_MA 0.1 GB         CA 1.57 GB         Max_CA 2 GB 
[2025-02-27 23:10:03,875] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 37.84 GB, percent = 15.0%
[2025-02-27 23:10:03,875] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed Final Optimizer = DeepSpeedZeroOptimizer_Stage3
[2025-02-27 23:10:03,875] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed using configured LR scheduler = None
[2025-02-27 23:10:03,875] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed LR Scheduler = None
[2025-02-27 23:10:03,875] [INFO] [logging.py:128:log_dist] [Rank 0] step=0, skipped=0, lr=[0.0001], mom=[(0.9, 0.999)]
[2025-02-27 23:10:03,880] [INFO] [config.py:999:print] DeepSpeedEngine configuration:
[2025-02-27 23:10:03,881] [INFO] [config.py:1003:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2025-02-27 23:10:03,881] [INFO] [config.py:1003:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True, 'use_gds': False}
[2025-02-27 23:10:03,881] [INFO] [config.py:1003:print]   amp_enabled .................. False
[2025-02-27 23:10:03,881] [INFO] [config.py:1003:print]   amp_params ................... False
[2025-02-27 23:10:03,881] [INFO] [config.py:1003:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2025-02-27 23:10:03,881] [INFO] [config.py:1003:print]   bfloat16_enabled ............. True
[2025-02-27 23:10:03,881] [INFO] [config.py:1003:print]   bfloat16_immediate_grad_update  False
[2025-02-27 23:10:03,881] [INFO] [config.py:1003:print]   checkpoint_parallel_write_pipeline  False
[2025-02-27 23:10:03,881] [INFO] [config.py:1003:print]   checkpoint_tag_validation_enabled  True
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   checkpoint_tag_validation_fail  False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f02abec7130>
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   communication_data_type ...... None
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   curriculum_enabled_legacy .... False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   curriculum_params_legacy ..... False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   data_efficiency_enabled ...... False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   dataloader_drop_last ......... False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   disable_allgather ............ False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   dump_state ................... False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   dynamic_loss_scale_args ...... None
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   eigenvalue_enabled ........... False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   eigenvalue_gas_boundary_resolution  1
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   eigenvalue_layer_num ......... 0
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   eigenvalue_max_iter .......... 100
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   eigenvalue_stability ......... 1e-06
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   eigenvalue_tol ............... 0.01
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   eigenvalue_verbose ........... False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   elasticity_enabled ........... False
[2025-02-27 23:10:03,882] [INFO] [config.py:1003:print]   flops_profiler_config ........ {
    "enabled": false, 
    "recompute_fwd_factor": 0.0, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   fp16_auto_cast ............... None
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   fp16_enabled ................. False
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   fp16_master_weights_and_gradients  False
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   global_rank .................. 0
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   grad_accum_dtype ............. None
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   gradient_accumulation_steps .. 32
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   gradient_clipping ............ 1.0
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   gradient_predivide_factor .... 1.0
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   graph_harvesting ............. False
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   hybrid_engine ................ enabled=False max_out_tokens=512 inference_tp_size=1 release_inference_cache=False pin_parameters=True tp_gather_partition_size=8
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   initial_dynamic_scale ........ 1
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   load_universal_checkpoint .... False
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   loss_scale ................... 1.0
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   memory_breakdown ............. False
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   mics_hierarchial_params_gather  False
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   mics_shard_size .............. -1
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   monitor_config ............... tensorboard=TensorBoardConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') comet=CometConfig(enabled=False, samples_log_interval=100, project=None, workspace=None, api_key=None, experiment_name=None, experiment_key=None, online=None, mode=None) wandb=WandbConfig(enabled=False, group=None, team=None, project='deepspeed') csv_monitor=CSVConfig(enabled=False, output_path='', job_name='DeepSpeedJobName')
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   optimizer_legacy_fusion ...... False
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   optimizer_name ............... None
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   optimizer_params ............. None
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0, 'pipe_partitioned': True, 'grad_partitioned': True}
[2025-02-27 23:10:03,883] [INFO] [config.py:1003:print]   pld_enabled .................. False
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   pld_params ................... False
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   prescale_gradients ........... False
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   scheduler_name ............... None
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   scheduler_params ............. None
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   seq_parallel_communication_data_type  torch.float32
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   sparse_attention ............. None
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   sparse_gradients_enabled ..... False
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   steps_per_print .............. inf
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   timers_config ................ enabled=True synchronized=True
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   train_batch_size ............. 128
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   train_micro_batch_size_per_gpu  2
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   use_data_before_expert_parallel_  False
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   use_node_local_storage ....... False
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   wall_clock_breakdown ......... False
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   weight_quantization_config ... None
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   world_size ................... 2
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   zero_allow_untested_optimizer  True
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   zero_config .................. stage=3 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=16777216 use_multi_rank_bucket_allreduce=True allgather_partitions=True allgather_bucket_size=500000000 overlap_comm=True load_from_fp32_weights=True elastic_checkpoint=False offload_param=DeepSpeedZeroOffloadParamConfig(device='cpu', nvme_path=None, buffer_count=5, buffer_size=100000000, max_in_cpu=1000000000, pin_memory=False) offload_optimizer=DeepSpeedZeroOffloadOptimizerConfig(device='cpu', nvme_path=None, buffer_count=4, pin_memory=False, pipeline_read=False, pipeline_write=False, fast_init=False, ratio=1.0) sub_group_size=1000000000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=15099494 param_persistence_threshold=40960 model_persistence_threshold=9223372036854775807 max_live_parameters=1000000000 max_reuse_distance=1000000000 gather_16bit_weights_on_model_save=True module_granularity_threshold=0 use_all_reduce_for_fetch_params=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False zero_hpz_partition_size=1 zero_quantized_weights=False zero_quantized_nontrainable_weights=False zero_quantized_gradients=False zeropp_loco_param=None mics_shard_size=-1 mics_hierarchical_params_gather=False memory_efficient_linear=True pipeline_loading_checkpoint=False override_module_apply=True
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   zero_enabled ................. True
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   zero_force_ds_cpu_optimizer .. True
[2025-02-27 23:10:03,884] [INFO] [config.py:1003:print]   zero_optimization_stage ...... 3
[2025-02-27 23:10:03,885] [INFO] [config.py:989:print_user_config]   json = {
    "bf16": {
        "enabled": true
    }, 
    "zero_optimization": {
        "stage": 3, 
        "overlap_comm": true, 
        "contiguous_gradients": true, 
        "sub_group_size": 1.000000e+09, 
        "reduce_bucket_size": 1.677722e+07, 
        "stage3_prefetch_bucket_size": 1.509949e+07, 
        "stage3_param_persistence_threshold": 4.096000e+04, 
        "stage3_max_live_parameters": 1.000000e+09, 
        "stage3_max_reuse_distance": 1.000000e+09, 
        "stage3_gather_16bit_weights_on_model_save": true, 
        "offload_param": {
            "device": "cpu"
        }, 
        "offload_optimizer": {
            "device": "cpu"
        }
    }, 
    "gradient_accumulation_steps": 32, 
    "gradient_clipping": 1.0, 
    "steps_per_print": inf, 
    "train_batch_size": 128, 
    "train_micro_batch_size_per_gpu": 2, 
    "wall_clock_breakdown": false, 
    "fp16": {
        "enabled": false
    }, 
    "zero_allow_untested_optimizer": true
}
02/27/2025 23:10:03 - INFO - __main__ - ***** Running training *****
02/27/2025 23:10:03 - INFO - __main__ -   Num examples = 300
02/27/2025 23:10:03 - INFO - __main__ -   Num Epochs = 2
02/27/2025 23:10:03 - INFO - __main__ -   Instantaneous batch size per device = 2
02/27/2025 23:10:03 - INFO - __main__ -   Total train batch size (w. parallel, distributed & accumulation) = 128
02/27/2025 23:10:03 - INFO - __main__ -   Gradient Accumulation steps = 32
02/27/2025 23:10:03 - INFO - __main__ -   Total optimization steps = 6
  0%|          | 0/6 [00:00<?, ?it/s] 17%|█▋        | 1/6 [02:46<13:51, 166.40s/it]02/27/2025 23:12:50 - INFO - __main__ -   Step: 1, LR: 8e-05, Loss: 1.1042654514312744
 33%|███▎      | 2/6 [05:16<10:26, 156.71s/it]02/27/2025 23:15:20 - INFO - __main__ -   Step: 2, LR: 6e-05, Loss: 1.0945754051208496
 50%|█████     | 3/6 [08:50<09:08, 182.82s/it]02/27/2025 23:18:54 - INFO - __main__ -   Step: 3, LR: 4e-05, Loss: 1.055281400680542
 67%|██████▋   | 4/6 [11:15<05:36, 168.05s/it]02/27/2025 23:21:19 - INFO - __main__ -   Step: 4, LR: 2e-05, Loss: 1.0623233318328857
tokenizer config file saved in models/llama2-gsm123-7b/tokenizer_config.json
Special tokens file saved in models/llama2-gsm123-7b/special_tokens_map.json
added tokens file saved in models/llama2-gsm123-7b/added_tokens.json
 67%|██████▋   | 4/6 [12:42<06:21, 190.53s/it]
